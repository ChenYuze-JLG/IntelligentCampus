<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>layout 管理系统大布局 - Layui</title>
  <!--    <link rel="stylesheet" href="../static/css/teachAffair.css">-->
  <link rel="stylesheet" href="//unpkg.com/layui@2.6.8/dist/css/layui.css">
  <!--    <script src="../static/layui/layui.js"></script>-->
  <script src="https://unpkg.com//layui@2.6.8//dist//layui.js"></script>
</head>
<body onload="contitionalLoad()">
  <!--标签栏-->
  <div class="layui-tab layui-tab-brief" lay-filter="tab-all">
    <br><br><br>
    <ul class="layui-tab-title">
      <li data-status=""   class="layui-this">各科成绩</li>
      <li data-status="1">标题2</li>
      <li data-status="3">标题3</li>
      <li data-status="5">标题4</li>
      <li data-status="6">标题5</li>
      <li data-status="7">标题6</li>
    </ul>
    <div   class="layui-tab-content">
      <div   class="layui-tab-item layui-show">
        <!--数据表放在对应标签里面显示-->
        <table id="scoreTest" lay-filter="test"></table>
      </div>
      <div   class="layui-tab-item">标题2</div>
      <div   class="layui-tab-item">标题3</div>
      <div   class="layui-tab-item">标题4</div>
      <div   class="layui-tab-item">标题5</div>
      <div   class="layui-tab-item">标题6</div>
    </div>
    <!--根据标签不同选择对应内容-->
    <script>
      layui.use('element', function () {
        var $ = layui.jquery, element = layui.element;
        element.on('tab(tab-all)', function (data) {
          var status = $(this).attr('data-status')
          console.log(status);
        })
      })
    </script>
    <script type="text/html" id="barDemo">
      <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
      <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>
    <script th:inline="javascript">
      function contitionalLoad() {
        // 根据当前登录者判断身份
        var isStudent = 1;
        if(isStudent >= 1) {
          layui.use('table', function () {
        var table = layui.table;
        table.render({
          elem: '#scoreTest'
          , height: 'full'
          , url: '/teachAffairManagement/ScoreRecord/getScoreForStudent' //数据接口
          , title: '学生成绩表'
          , page: true //开启分页
          , limit: 10  // 每页显示的条数
          , limits: [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]  //每页显示条数的可选择数目
          // ,autoSort: false //禁用前端自动排序
          , initSort: {  //初始化排序方式
            field: 'courseID' //排序字段，对应 cols 设定的各字段名
            , type: 'asc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
          }
          , cols: [
            [
              {field: 'studentID', title: '学生ID', width: 120, sort: true}
              , {field: 'courseID', title: '课程ID', width: 120}
              , {field: 'teachClassID', title: '教学班ID', width: 120, sort: true}
              , {field: 'teacherID', title: '教师ID', width: 120, sort: true}
              , {field: 'collegeID', title: '学院ID', width: 120}
              , {field: 'credit', title: '学分', width: 120, sort: true}
              , {field: 'score', title: '分数', width: 120, sort: true}
              , {fixed: 'right', title: '操作', toolbar: '#barDemo', width: 120}
            ]
          ]
        });

        //监听行工具事件
        table.on('tool(test)', function (obj) {
          var data = obj.data;
          //console.log(obj)
          if (obj.event === 'del') {
            layer.confirm('真的删除行么', function (index) {
              obj.del();
              layer.close(index);
            });
          } else if (obj.event === 'edit') {
            layer.prompt({
              formType: 2
              , value: data.email
            }, function (value, index) {
              obj.update({
                email: value
              });
              layer.close(index);
            });
          }
        });
        //触发排序事件
        table.on('sort(test)', function (obj) { //注：sort 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
          console.log(obj.field); //当前排序的字段名
          console.log(obj.type); //当前排序类型：desc（降序）、asc（升序）、null（空对象，默认排序）
          console.log(this); //当前排序的 th 对象

          //尽管我们的 table 自带排序功能，但并没有请求服务端。
          //有些时候，你可能需要根据当前排序的字段，重新向服务端发送请求，从而实现服务端排序，如：
          table.reload('scoreTest', {
            initSort: obj //记录初始排序，如果不设的话，将无法标记表头的排序状态。
            , where: { //请求参数（注意：这里面的参数可任意定义，并非下面固定的格式）
              field: obj.field //排序字段
              , order: obj.type //排序方式
            }
          });
          layer.msg('服务端排序。order by ' + obj.field + ' ' + obj.type);
        });
      });
        } else {
          layui.use('table', function () {
            var table = layui.table;
            table.render({
              elem: '#scoreTest'
              , height: 'full'
              , url: '/teachAffairManagement/ScoreRecord/getStudentScore' //数据接口
              , title: '学生成绩表'
              , page: true //开启分页
              , limit: 10  // 每页显示的条数
              , limits: [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]  //每页显示条数的可选择数目
              // ,autoSort: false //禁用前端自动排序
              , initSort: {  //初始化排序方式
                field: 'courseID' //排序字段，对应 cols 设定的各字段名
                , type: 'asc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
              }
              , cols: [
                [
                  {field: 'studentID', title: '学生ID', width: 120, sort: true}
                  , {field: 'courseID', title: '课程ID', width: 120}
                  , {field: 'teachClassID', title: '教学班ID', width: 120, sort: true}
                  , {field: 'teacherID', title: '教师ID', width: 120, sort: true}
                  , {field: 'collegeID', title: '学院ID', width: 120}
                  , {field: 'credit', title: '学分', width: 120, sort: true}
                  , {field: 'score', title: '分数', width: 120, sort: true}
                  , {fixed: 'right', title: '操作', toolbar: '#barDemo', width: 120}
                ]
              ]
            });

            //监听行工具事件
            table.on('tool(test)', function (obj) {
              var data = obj.data;
              //console.log(obj)
              if (obj.event === 'del') {
                layer.confirm('真的删除行么', function (index) {
                  obj.del();
                  layer.close(index);
                });
              } else if (obj.event === 'edit') {
                layer.prompt({
                  formType: 2
                  , value: data.email
                }, function (value, index) {
                  obj.update({
                    email: value
                  });
                  layer.close(index);
                });
              }
            });
            //触发排序事件
            table.on('sort(test)', function (obj) { //注：sort 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
              console.log(obj.field); //当前排序的字段名
              console.log(obj.type); //当前排序类型：desc（降序）、asc（升序）、null（空对象，默认排序）
              console.log(this); //当前排序的 th 对象

              //尽管我们的 table 自带排序功能，但并没有请求服务端。
              //有些时候，你可能需要根据当前排序的字段，重新向服务端发送请求，从而实现服务端排序，如：
              table.reload('scoreTest', {
                initSort: obj //记录初始排序，如果不设的话，将无法标记表头的排序状态。
                , where: { //请求参数（注意：这里面的参数可任意定义，并非下面固定的格式）
                  field: obj.field //排序字段
                  , order: obj.type //排序方式
                }
              });
              layer.msg('服务端排序。order by ' + obj.field + ' ' + obj.type);
            });
          });
        }
      }
    </script>
  </div>
</body>